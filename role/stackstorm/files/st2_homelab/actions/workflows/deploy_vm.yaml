version: 1.0
description: Deploy a new VM.

input: 
  - hostname

tasks:
  echo_hostname:
    action: core.local
    input:
      cmd: |
        hostname
    next:
      - when: <% succeeded() %>
        do: echo_remote_hostname
        publish:
          - var1: <% result().stdout %>
  
  echo_remote_hostname:
    action: core.remote
    input:
      hosts: "saltmaster.homelab.lan"
      username: root
      cmd: |
        hostname
    next:
      - when: <% succeeded() %>
        publish:
          - var2: <% result().stdout %>

output:
  - var1: <% ctx().var1 %>
  - var2: <% ctx().var2 %>